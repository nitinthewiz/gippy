<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>GIPPY - See the latest Python projects on GitHub</title>
		<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.0.js"></script>
		<script type="text/javascript" src="http://www.json2html.com/js/json2html.js"></script>
		<script type="text/javascript" src="http://www.json2html.com/js/jquery.json2html.js"></script>
		<link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.2.0+2/spacelab/bootstrap.css">
		<link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.2.0+2/spacelab/bootstrap.min.css">
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.3/moment.min.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/livestamp/1.1.2/livestamp.min.js"></script>
		<style type="text/css">
			.col-centered{
				float: none;
				margin: 0 auto;
			}
			.panel-default{
				margin-bottom: 0px;
			}
		</style>
		<script type="text/javascript">
			//<![CDATA[ 
			$(window).load(function(){
				// this function brought to us by http://css-tricks.com/snippets/javascript/get-url-variables/
				function getQueryVariable(variable){
					var query = window.location.search.substring(1);
					var vars = query.split("&");
					for (var i=0;i<vars.length;i++) {
						var pair = vars[i].split("=");
						if(pair[0] == variable){return pair[1];}
					}
					return(false);
				}
				// http://stackoverflow.com/questions/1026069/capitalize-the-first-letter-of-string-in-javascript
				function capitaliseFirstLetter(string){
					return string.charAt(0).toUpperCase() + string.slice(1);
				}
				var myjson;
				var lang = "python";
				var transform = [{"tag":"li","id":"${id}","data-pushed":"${pushed_at}","class":"list-group-item","children":[
					{"tag":"h4","align":"center","children":[
						{"tag":"a","href":"${html_url}","target":"_blank","html":"${full_name}"}
					]},
					{"tag":"div","class":"panel panel-default","children":[
						{"tag":"div","class":"panel-heading","children":[
							{"tag":"img","border":"5","src":"${owner.avatar_url}","align":"left","style":"height:40px;"},
							{"tag":"a","href":"${html_url}","target":"_blank","html":"${owner.login}"}
						]},
						{"tag":"div","class":"panel-body","html":"Description: ${description}"},
						{"tag":"div","class":"panel-footer","children":[
							{"tag":"div","class":"row","children":[
								{"tag":"div","class":"col-lg-2 label label-primary","html":"Stars: ${stargazers_count}"},
								{"tag":"div","class":"col-lg-2 label label-primary","html":"Forks: ${forks_count}"},
								{"tag":"div","class":"col-lg-4 label label-primary","html":"Updated ","children":[
									{"tag":"span","data-livestamp":"${updated_at}","class":"time","html":function() {
										return(moment(this.updated_at, "YYYY-MM-DDTh:mm:sZ").fromNow());
									}}
								]},
								{"tag":"div","class":"col-lg-4 label label-primary","html":"Code pushed ","children":[
									{"tag":"span","data-livestamp":"${pushed_at}","class":"time","html":function() {
										return(moment(this.pushed_at, "YYYY-MM-DDTh:mm:sZ").fromNow());
									}}
								]}
							]}
						]}
					]}
				]}];
				console.log(getQueryVariable("lang"));
				if(getQueryVariable("lang") != false){
					lang = getQueryVariable("lang");
					$('.thelang').text(capitaliseFirstLetter(lang));
				}
				$.getJSON("https://api.github.com/search/repositories?q=language:"+lang+"&sort=updated", function(json){
					myjson = json;
					$('#feed').json2html(myjson.items.reverse(),transform);
				});
				setInterval(function(){
					$.getJSON("https://api.github.com/search/repositories?q=language:"+lang+"&sort=updated", function(json){
						myjson = json;
						$.each(myjson.items, function( key, value ) {
							var $current_top_element = $('body').children().first();
							if($("#" + value.id).length == 0) {
								//console.log($('#'+value.id));
								$('#feed').json2html(value,transform,{'append':'true'});
							}
							else{
								if ($('#'+value.id).data("pushed") != value.pushed_at){
									$('#'+value.id).remove();
									$('#feed').json2html(value,transform,{'append':'true'});
								}
							}
						});
					});
				}, 30000);

				$('h2').click(function() {
					window.location= "./gippy.html"
				});
			});//]]>
		</script>
		<style type="text/css"></style>
	</head>
	<body>
		<h2 align="center"><span class="thelang">Python</span> Repos recently updated on GitHub</h2>
		<h4 align="center">Also supports other languages, just try <a href="./gippy.html?lang=php">this link for php</a>, <a href="./gippy.html?lang=javascript">this one for javascript</a> and <a href="./gippy.html?lang=swift">this one for swift</a>. The default language is python.</h4>
		<div class="row">
			<div class="col-lg-6 col-centered">
				<ul class="list-group" id="feed"></ul>
			</div>
		</div>
	</body>
</html>
